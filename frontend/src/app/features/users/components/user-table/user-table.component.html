<!-- English: Users table with actions and status. -->
<!-- Italiano: tabella utenti con azioni e stati. -->
<!-- English: Sections include header, user rows, loading skeleton. -->
<!-- Italiano: Sezioni: intestazione, righe utenti, skeleton loading. -->
<!-- English: UI/UX choice: compact rows for high information density. -->
<!-- Italiano: Scelte UI/UX: righe compatte per alta densita informativa. -->
<div class="table-wrapper">
  <table class="user-table" *ngIf="!loading">
    <thead>
      <tr>
        <th scope="col">User</th>
        <th scope="col">Roles</th>
        <th scope="col">Status</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let user of users; trackBy: trackById"
        [class.is-disabled]="!user.enabled"
      >
        <td>
          <div class="user-cell">
            <span class="user-email">{{ user.email }}</span>
            <span class="user-meta">ID #{{ user.id }}</span>
          </div>
        </td>
        <td>
          <div class="role-badges">
            <ui-badge
              *ngFor="let role of user.roles"
              [label]="roleLabel(role)"
              [tone]="roleTone(role)"
            ></ui-badge>
          </div>
        </td>
        <td>
          <ui-badge [label]="statusLabel(user)" [tone]="statusTone(user)"></ui-badge>
        </td>
        <td>
          <div class="row-actions">
            <!-- English: View/edit actions (UI ready, logic in parent). -->
            <!-- Italiano: Azioni view/edit (UI pronta, logica nel parent). -->
            <ui-button variant="ghost" size="sm" (click)="viewUser.emit(user)">Details</ui-button>
            <ui-button
              *ngIf="!isAdminOnly(user)"
              variant="secondary"
              size="sm"
              (click)="editUser.emit(user)"
            >
              Edit
            </ui-button>
            <!-- English: Toggle with confirmation handled by parent. -->
            <!-- Italiano: Toggle con conferma gestita dal parent. -->
            <ui-toggle
              *ngIf="!isAdminOnly(user)"
              [checked]="user.enabled"
              [ariaLabel]="user.enabled ? 'Disable user' : 'Enable user'"
              (changed)="requestToggle(user)"
            ></ui-toggle>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- English: Loading skeleton. -->
  <!-- Italiano: Skeleton per caricamento. -->
  <div class="skeleton" *ngIf="loading">
    <div class="skeleton-row" *ngFor="let _ of [1, 2, 3, 4]"></div>
  </div>
</div>
